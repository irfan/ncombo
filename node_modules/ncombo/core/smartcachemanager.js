var SmartCacheManager = function(cacheVersion) {
	var self = this;
	
	self.setURLCacheVersion = function(url) {
		var match = url.match(/(^[^?]*)(([?])(.*))?/);
		
		if(match) {
			var versionVar = 'cv';
			var mainPart = match[1];
			if(match[4]) {
				var fieldStrings = match[4].split('&');
				var temp;
				var fields = {};
				var i;
		
				for(i in fieldStrings) {
					temp = fieldStrings[i].split('=');
					fields[temp[0]] = temp[1] || true;
				}
		
				fields[versionVar] = cacheVersion;
		
				fieldStrings = [];
		
				for(i in fields) {
					fieldStrings.push(i + '=' + fields[i]);
				}
	
				return mainPart + '?' + fieldStrings.join('&');
			} else {
				return mainPart + '?' + versionVar + '=' + cacheVersion;
			}
		}
	
		throw new Error('Invalid url specified');
	}
}

if(typeof window === 'undefined') {
	module.exports.SmartCacheManager = SmartCacheManager;
} else {
	var NCOMBO_CACHE_VERSION /*{{cacheVersion}}*/;
	var smartCacheManager = new SmartCacheManager(NCOMBO_CACHE_VERSION);
}