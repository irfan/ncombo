var fs = require('fs'),
	path = require('path'),
	less = require('less'),
	wrench = require('wrench'),
	jsp = require("uglify-js").parser,
	pro = require("uglify-js").uglify,
	cache = require('ncombo/cache');

var Router = new (function() {
	var self = this;
	self._privateExtension = /$a/;
	
	self.run = function(req, res, next) {
		if(req.rout.buffer) {
			next();
		} else {
			if(self._privateExtension && self._privateExtension.test(req.rout.filePath)) {
				res.writeHead(403);
				res.end('Request ' + req.url + ' refers to a private resource which cannot be accessed directly');
			} else {
				var fileStream = fs.createReadStream(req.rout.filePath);
				req.rout.appendStream(fileStream);
				
				next();
			}
		}
	}
})();

module.exports = Router;
